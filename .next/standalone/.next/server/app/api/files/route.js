"use strict";(()=>{var e={};e.id=887,e.ids=[887],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},7480:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>j,originalPathname:()=>g,patchFetch:()=>C,requestAsyncStorage:()=>y,routeModule:()=>E,serverHooks:()=>m,staticGenerationAsyncStorage:()=>S,staticGenerationBailout:()=>A});var s={};t.r(s),t.d(s,{GET:()=>f,POST:()=>v});var a=t(5419),n=t(9108),o=t(9678),i=t(8070),u=t(7147),l=t.n(u),c=t(1017),p=t.n(c),d=t(7447);let h=process.env.STORAGE_PATH||p().resolve(process.cwd(),"../storage");async function f(e){let r;let t=e.headers.get("Authorization")?.split("Bearer ")[1];if(!t)return i.Z.json({error:"Unauthorized"},{status:401});try{let e=await d.C?.verifyIdToken(t);r=e?.uid}catch(e){return i.Z.json({error:"Invalid token"},{status:401})}if(!r)return i.Z.json({error:"User not found"},{status:401});let s=e.nextUrl.searchParams.get("path")||"",a=s.replace(/^(\.\.(\/|\\|$))+/,""),n=p().join(h,r),o=p().resolve(n,a);if(!o.startsWith(n))return i.Z.json({error:"Invalid path"},{status:403});try{if(l().existsSync(n)||l().mkdirSync(n,{recursive:!0}),!l().existsSync(o))return i.Z.json({items:[]});let e=l().readdirSync(o,{withFileTypes:!0}).map(e=>({name:e.name,type:e.isDirectory()?"folder":"file",size:e.isDirectory()?0:l().statSync(p().join(o,e.name)).size}));return i.Z.json({path:s,items:e})}catch(e){return console.error(e),i.Z.json({error:"Internal Server Error"},{status:500})}}async function v(e){let r;let t=e.headers.get("Authorization")?.split("Bearer ")[1];if(!t)return i.Z.json({error:"Unauthorized"},{status:401});try{let e=await d.C?.verifyIdToken(t);r=e?.uid}catch(e){return i.Z.json({error:"Invalid token"},{status:401})}try{let{folderName:t,currentPath:s}=await e.json(),a=p().join(h,r),n=(s||"").replace(/^(\.\.(\/|\\|$))+/,""),o=p().resolve(a,n,t);if(!o.startsWith(a))return i.Z.json({error:"Invalid path"},{status:403});if(l().existsSync(o))return i.Z.json({error:"Folder already exists"},{status:400});return l().mkdirSync(o,{recursive:!0}),i.Z.json({success:!0,path:p().join(n,t)})}catch(e){return console.error(e),i.Z.json({error:"Internal Server Error"},{status:500})}}let E=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/files/route",pathname:"/api/files",filename:"route",bundlePath:"app/api/files/route"},resolvedPagePath:"/home/stev/Documentos/Griego2/src/app/api/files/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:S,serverHooks:m,headerHooks:j,staticGenerationBailout:A}=E,g="/api/files/route";function C(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:S})}},7447:(e,r,t)=>{t.d(r,{C:()=>n,db:()=>o});let s=require("firebase-admin");var a=t.n(s);if(!a().apps.length){if(process.env.FIREBASE_SERVICE_ACCOUNT)try{let e=JSON.parse(process.env.FIREBASE_SERVICE_ACCOUNT);a().initializeApp({credential:a().credential.cert(e),storageBucket:process.env.FIREBASE_STORAGE_BUCKET||"udea-filosofia.firebasestorage.app"})}catch(e){console.error("Failed to parse FIREBASE_SERVICE_ACCOUNT",e)}else console.warn("FIREBASE_SERVICE_ACCOUNT not set. Admin features may fail.")}let n=a().apps.length?a().auth():null;a().apps.length&&a().storage();let o=a().apps.length?a().firestore():null}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,206],()=>t(7480));module.exports=s})();